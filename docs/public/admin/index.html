<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>
    <script type="text/javascript" src="https:identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <!-- Fix: https:answers.netlify.com/t/netlify-cms-markdown-editor-wonkness/79815 -->
    <style>
      div[data-slate-editor] {
          -webkit-user-modify: read-write!important;
      }
    </style>
  </head>

  <body>

    <!-- Add a menu:
    Log in / Sign up - when the user is not logged in
    Username / Log out - when the user is logged in
    -->
    <!-- <div data-netlify-identity-menu></div> -->


    <!-- Add a simpler button:
      Simple button that will open the modal.
      <div data-netlify-identity-button>Login with Netlify Identity</div>
    -->
    

    <!-- Include the script that builds the page and powers Decap CMS -->
    <script src="https:unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>

    <script>
      var PostPreview = createClass({
        render: function() {
          var entry = this.props.entry;
          return h('div', {},
            h('div', {"className": "text"}, this.props.widgetFor('body'))
          );
        }
      });

      CMS.registerPreviewTemplate("posts", PostPreview);
      CMS.registerPreviewStyle('./preview.css');

      CMS.registerEditorComponent({
        id: "youtube",
        label: "Youtube",
        fields: [{name: 'id', label: 'Youtube Video ID'}],
        pattern: /^{{<\s?youtube (\S+)\s?>}}/,
        fromBlock: function(match) {
          return {
            id: match[1]
          };
        },
        toBlock: function(obj) {
          return '{{< youtube ' + obj.id + ' >}}';
        },
        toPreview: function(obj) {
          return (
            '<img src="http:img.youtube.com/vi/' + obj.id + '/maxresdefault.jpg" alt="Youtube Video"/>'
          );
        }
      });

      CMS.registerEditorComponent({
        id: 'file',
        label: 'File',
        fields: [
          {
            label: 'File',
            name: 'file',
            widget: 'file'
          },
          {
            label: 'Label',
            name: 'label'
          }
        ],
        // Pattern to identify a block as being an instance of this component
        pattern: /^{{\\_(.*)\\_-\/images\/uploads\/(.*)-}}$/,
        // Function to extract data elements from the regexp match
        fromBlock: match =>
          match && {
            file: match[2],
            label: match[1]
          },
        // Function to create a text block from an instance of this component
        toBlock: data => `{{_${data.label || ''}_-${data.file || ''}-}}`,
        toPreview: function (obj) {
          return ''
        }
      })
    </script>
  </body>
</html>